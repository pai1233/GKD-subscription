name: Upstream Sync

on:
  push:
    branches:
      - '**'

permissions: write-all

jobs:
  sync_latest_from_upstream:
    name: Sync latest commits from upstream repo
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        run: |
          git config --local user.email github-actions[bot]@users.noreply.github.com
          git config --local user.name github-actions[bot]

      - name: Download remote ganlinte JSON
        run: |
          echo "[info] 下载ganlinte订阅数据"
          curl -L -o ganlinte-gkd.json "https://raw.githubusercontent.com/ganlinte/GKD-subscription/main/dist/ganlin_gkd.json5"
          git add ganlinte-gkd.json
          git diff --cached --quiet || git commit -m "auto-update ganlinte-gkd.json"	  

      - name: Sync check
        uses: ad-m/github-push-action@master
        with:
          branch: ${{ github.ref }}
